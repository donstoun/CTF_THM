# Уязвимость SSRF (Server-Side Request Forgery)

## Описание уязвимости

**Server-Side Request Forgery (SSRF)** — это уязвимость, которая позволяет атакующему заставить сервер выполнить запросы от его имени. Обычно это связано с сервером, который принимает HTTP-запросы от пользователя и может обращаться к различным внутренним ресурсам. Если злоумышленник может контролировать URL, к которому сервер обращается, это открывает возможности для атак.

SSRF уязвимости часто используются для обхода ограничений, таких как фаерволы или внутренние сети, и могут дать доступ к защищённым частям системы.

### Как работает SSRF?

1.  **Атакующий отправляет запрос на сервер**, который принимает внешние HTTP-запросы.
    
2.  **Сервер обрабатывает запрос** и отправляет его на указанный в запросе URL, например, на внутренний сервис, доступный только внутри сети.
    
3.  **Атакующий манипулирует URL**, чтобы запросить данные с локальных, защищённых или даже закрытых сервисов, к которым обычный пользователь не может получить доступ.
    

## Пример из CTF-машины MD2PDF

В ходе работы с машиной **MD2PDF** на платформе **TryHackMe** была обнаружена уязвимость SSRF. Задача заключалась в том, чтобы получить доступ к скрытым административным страницам, которые были доступны только с локального хоста (`localhost:5000`).

### Шаги эксплуатации:

1.  **Сканирование порта** с помощью Nmap показало, что на порту 80 работает веб-сервер.
    
2.  После того как мы открыли сайт, увидели сервис для конвертации файлов в PDF.
    
3.  С помощью **Gobuster** мы нашли скрытую директорию `/admin`, которая была защищена и возвращала ошибку 403 (Forbidden).
    
4.  Мы заметили, что страница `/admin` доступна только через **localhost:5000**. Это ограничение предотвращало доступ извне.
    
5.  В этот момент была использована **уязвимость SSRF**: мы внедрили в сайт **iframe**, который обращался к странице `/admin` на сервере, минуя ограничение.
    
6.  Сервер, принимая запрос с его стороны, смог получить доступ к странице `/admin`, которая была доступна только на локальном хосте.
    
7.  После того как запрос был выполнен, сервер сгенерировал PDF, который содержал флаг, скрывавшийся на странице `/admin`.
    
## Как можно использовать iframe в атаках:

В случае с уязвимостью **SSRF**, iframe может быть использован для того, чтобы заставить сервер выполнить запрос, который он обычно не может сделать. Например, злоумышленник может вставить iframe, который будет обращаться к защищённой странице, доступной только через локальный хост.

Пример использования iframe для обхода ограничений:

```<iframe src="http://localhost:5000/admin" height="1000" width="1000"></iframe>```



Когда сервер генерирует PDF, он может выполнить запрос к этой локальной странице, потому что запрос будет считаться исходящим от самого сервера, а не от внешнего пользователя. Это позволяет обойти доступные фильтры и получить конфиденциальную информацию, скрытую на защищённых страницах.

### Заключение

**SSRF** — это мощная уязвимость, которая позволяет атакующему использовать сервер как прокси для выполнения запросов, минуя различные защиты и ограничения. В данном случае мы использовали SSRF для обхода ограничений доступа к скрытым административным страницам.
